$(function(){Tipped.create('.地支-tooltip',{position:'bottomright'});});$(document).on("click tap","#btn-斗數",function(){清除命盤();var 輸入曆法=getRadioSelection(document.getElementsByName('mp-輸入曆法'));var 輸入年=$("#mp-輸入年").val();var 輸入月=$("#mp-輸入月").val();var 輸入日=$("#mp-輸入日").val();var 輸入時=$("#mp-輸入時").val();var 輸入分=$("#mp-輸入分").val();var 輸入秒="00";var 輸入時間;var 輸入閏月=getCheckboxStatus("mp-輸入月-閏月");var 輸入姓名=$("#mp-輸入姓名").val();var 輸入性別=getRadioSelection(document.getElementsByName('mp-輸入性別'));輸入時間=輸入時+輸入分+輸入秒;var 日期字串;switch(輸入曆法){case "西曆":系統.設定.運行狀態.已輸入命盤=true;日期字串=輸入日+輸入月+輸入年+輸入時間;break;case "農曆":var 農曆生日字串=輸入年+輸入月+輸入日+輸入時間;var 西曆生日=農曆轉換西曆(農曆生日字串,輸入閏月);if(西曆生日!=""){西曆生日.setHours(Number(輸入時間.substr(0,2)));西曆生日.setMinutes(Number(輸入時間.substr(2,2)));西曆生日.setSeconds(Number(輸入時間.substr(4,2)));$("input:radio[name=mp-輸入曆法][value = 西曆]").trigger('click');$("#mp-輸入年").val(西曆生日.getFullYear());$("#mp-輸入月").val(zeroPad(西曆生日.getMonth()+1,2));$("#mp-輸入日").val(zeroPad(西曆生日.getDate(),2));輸入年=$("#mp-輸入年").val();輸入月=$("#mp-輸入月").val();輸入日=$("#mp-輸入日").val();日期字串=輸入日+輸入月+輸入年+輸入時間;系統.設定.運行狀態.已輸入命盤=true;}break;}var 輸入資料={"曆法":輸入曆法,"年":輸入年,"月":輸入月,"日":輸入日,"時":輸入時,"分":輸入分,"日期字串":日期字串,"西曆日期":日期值轉換(日期字串,1),"運算西曆":日期值轉換(日期字串,1),"干支八字":"","姓名":輸入姓名,"性別":輸入性別,"城市":"台北","節氣用區域時間":false,"節氣用軌道太陽時":false};if(系統.設定.運行狀態.已輸入命盤){斗數命盤=new 斗數命盤架構(輸入資料,系統);排星曜(斗數命盤);刷新命盤資訊(斗數命盤);$("#DouShuChart").show();刷新四化格式();$(".ds-大限歲數").removeClass("ds-當下大限歲數");if(斗數命盤.運行.大限數>0)$("#大限歲數格-"+斗數命盤.大限[斗數命盤.運行.大限數].地支數).addClass("ds-當下大限歲數");斗數命盤.運行.中宮菜單=1;$("#Menu-中宮資訊").show();$("#Menu-四化飛伏").hide();UI_Customization();if(系統.設定.用戶設定.功能.命盤分析){斗數本命分析模塊(斗數命盤);大限分析(斗數命盤);}}});$(document).on("click touchstart",".ds-大限歲數",function(){var 地支數=$(this).attr("data-地支數");斗數命盤.運行.大限=true;斗數命盤.運行.大限數=斗數命盤.地支宮位[地支數].大限數;刷新命盤大限(地支數,斗數命盤);$(".ds-大限歲數").removeClass("ds-當下大限歲數");$("#大限歲數格-"+地支數).addClass("ds-當下大限歲數");});$(document).on("click touchstart",".ds-大限宮位",function(){清除大限宮位();斗數命盤.運行.大限=false;斗數命盤.運行.流年=false;});$(document).on("click touchstart",".ds-流年年字",function(){if($(this).attr("data-大運流年數")>=0){斗數命盤.運行.大限流年矩陣數=Number($(this).attr("data-大運流年數"));斗數命盤.運行.流年地支數=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].地支數;刷新命盤流年(斗數命盤.運行.流年地支數);斗數命盤.運行.歲數=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].歲數;斗數命盤.運行.流年數=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].西曆年;斗數命盤.運行.流年干支=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].流年干支;斗數命盤.運行.流年十神=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].流年天干十神;斗數命盤.運行.流年=true;var 流年歲數=斗數命盤.運行.流年數+""+斗數命盤.運行.流年干支+"年，"+斗數命盤.運行.歲數+"歲，"+斗數命盤.運行.流年十神;$("#中宮資訊-流年").html(流年歲數);}});$(document).on("click touchstart",".ds-流年歲字",function(){if($(this).attr("data-大運流年歲數")>=0){斗數命盤.運行.大限流年矩陣數=Number($(this).attr("data-大運流年歲數"));斗數命盤.運行.流年地支數=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].地支數;刷新命盤流年(斗數命盤.運行.流年地支數);斗數命盤.運行.歲數=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].歲數;斗數命盤.運行.流年數=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].西曆年;斗數命盤.運行.流年干支=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].流年干支;斗數命盤.運行.流年十神=斗數命盤.大限[斗數命盤.運行.大限數].流年[斗數命盤.運行.大限流年矩陣數].流年天干十神;斗數命盤.運行.流年=true;var 流年歲數=斗數命盤.運行.流年數+""+斗數命盤.運行.流年干支+"年，"+斗數命盤.運行.歲數+"歲，"+斗數命盤.運行.流年十神;$("#中宮資訊-流年").html(流年歲數);刷新命盤流年(斗數命盤.運行.流年地支數);}});$(document).on("click touchstart",".ds-流年宮位",function(){清除流年宮位();斗數命盤.運行.流年=false;});$(document).on("click touchstart",".zgSldMenuDot",function(){var CentralCourtMenu=Number($(this).attr("data-sldmenu"));斗數命盤.運行.中宮菜單=CentralCourtMenu;switch(CentralCourtMenu){case 1:$("#Menu-中宮資訊").show();$("#Menu-四化飛伏").hide();break;case 2:$("#Menu-中宮資訊").hide();$("#Menu-四化飛伏").show();$("#Menu-四化飛伏").addClass("ds-中宮四化飛伏註解");$("#Menu-四化飛伏").html(斗數命盤.運行.架構飛四化分析);break;case 4:$("#Menu-中宮資訊").hide();$("#Menu-四化飛伏").hide();break;}});$(document).on("mousedown",".ds-宮干",function(){var 宮干=$(this).html();var 地支數=$(this).attr("data-地支數");if(系統.設定.用戶設定.功能.飛宮干四化)宮干四化選星(斗數命盤,宮干,地支數);if(系統.設定.用戶設定.功能.架構飛四化){星曜架構飛四化(斗數命盤,地支數);if(斗數命盤.運行.中宮菜單==2)$("#Menu-四化飛伏").html(斗數命盤.運行.架構飛四化分析);}});$(document).on("mouseup",".ds-宮干",function(){switch(event.which){case 1:if(斗數命盤.運行.宮干MouseDown>=0){清除星曜顏色();斗數命盤.運行.宮干MouseDown= -1;}}});$(document).on("touchstart",".ds-宮干",function(){var 宮干=$(this).html();var 地支數=$(this).attr("data-地支數");宮干四化選星(斗數命盤,宮干,地支數);});$('.ds-地支格子').on('doubleTap',function(){if(斗數命盤.運行.宮干MouseDown>=0){清除星曜顏色();斗數命盤.運行.宮干MouseDown= -1;}});$('.ds-中宮主體').on('swipe',function onSwipe(e,Dx,Dy){alert("sweep liao - e:"+e+", Dx:"+Dx+", Dy:"+Dy);});function 宮干四化選星(命盤,宮干,地支數){if(斗數命盤.運行.宮干MouseDown>=0){清除星曜顏色();斗數命盤.運行.宮干MouseDown= -1;}var 宮干四化星曜=十干四化(宮干);var 化星位置={"化祿":"星曜格-"+命盤.星曜[宮干四化星曜.化祿].命盤位置,"化權":"星曜格-"+命盤.星曜[宮干四化星曜.化權].命盤位置,"化科":"星曜格-"+命盤.星曜[宮干四化星曜.化科].命盤位置,"化忌":"星曜格-"+命盤.星曜[宮干四化星曜.化忌].命盤位置};命盤.運行.宮干MouseDown=地支數;switch(系統.設定.用戶設定.命盤顯示.宮干四化顯示){case 0:$("#"+化星位置.化祿).addClass("化祿字體顏色");$("#"+化星位置.化權).addClass("化權字體顏色");$("#"+化星位置.化科).addClass("化科字體顏色");$("#"+化星位置.化忌).addClass("化忌字體顏色");break;case 1:$("#"+化星位置.化祿).addClass("化祿背景顏色");$("#"+化星位置.化權).addClass("化權背景顏色");$("#"+化星位置.化科).addClass("化科背景顏色");$("#"+化星位置.化忌).addClass("化忌背景顏色");case 2:$("#"+化星位置.化祿).addClass("化祿星曜顏色");$("#"+化星位置.化權).addClass("化權星曜顏色");$("#"+化星位置.化科).addClass("化科星曜顏色");$("#"+化星位置.化忌).addClass("化忌星曜顏色");$("#宮干格-"+地支數).addClass("宮干飛顏色");}$("#ds-DZ-"+地支數).addClass("飛四化人事宮");if(命盤.運行.宮干MouseDown>=0){setInterval("宮干四化選星",100);}};function 刷新命盤資訊(命盤){var 性別名字=命盤.陽男陰女+" "+命盤.輸入資料.姓名;var 陽曆生日=命盤.生日.西曆生日格式.西曆日期;var 陰曆生日=命盤.生日.陰曆;var 五行局=命盤.五行局.局名;var 八字=命盤.八字.substr(0,2)+" "+命盤.八字.substr(2,2)+" "+命盤.八字.substr(4,2)+" "+命盤.八字.substr(6,2);var 流年歲數=命盤.運行.流年數+""+命盤.運行.流年干支+"年，"+命盤.運行.歲數+"歲，"+命盤.運行.流年十神;if(命盤.運行.歲數<1)流年歲數="";$("#中宮資訊-命主").html(性別名字);$("#中宮資訊-陽曆生日").html(陽曆生日);$("#中宮資訊-陰曆生日").html(陰曆生日);$("#中宮資訊-五行局").html(五行局);$("#中宮資訊-八字").html(八字);$("#中宮資訊-流年").html(流年歲數);};function 清除命盤(){var NullChar;for(var i=0;i<12;i++){for(var j=0;j<6;j++){$("#星曜格-"+i+"-"+Number(j+1)).html("<br><br>");$("#四化格-"+i+"-"+Number(j+1)).html("<br>");$("#自化格-"+i+"-"+Number(j+1)).html("<br>");}$("#宮名格-"+i).html("<br>");$("#宮干格-"+i).html("<br>");$("#地支格-"+i).html("<br>");$("#大限宮位-"+i).html("<br>");$("#大限歲數格-"+i).html("<br>");$("#流年宮位-"+i).html("<br>");$("#流年歲數格-"+i).html("<br>");$("#流年份格-"+i).html("<br>");if(i==7||i==8||i==1||i==2)NullChar="&nbsp";else NullChar="<br>";$("#流出格-"+i+"-1").html(NullChar);$("#流出格-"+i+"-2").html(NullChar);$("#流出格-"+i+"-3").html(NullChar);}$("#中宮資訊-命主").html("");$("#中宮資訊-陽曆生日").html("");$("#中宮資訊-陰曆生日").html("");$("#中宮資訊-五行局").html("");$("#中宮資訊-八字").html("");$("#中宮資訊-流年").html("");$("#中宮資訊-流年十神").html("");$(".ds-大限歲數").removeClass("ds-當下大限歲數");清除星曜顏色();};function 清除大限宮位(){for(var i=0;i<12;i++){$("#大限宮位-"+i).html("<br>");清除流年宮位歲數年份();}};function 清除流年宮位歲數年份(){for(var i=0;i<12;i++){$("#流年宮位-"+i).html("<br>");$("#流年歲數格-"+i).html("<br>");$("#流年份格-"+i).html("<br>");$("#中宮資訊-流年").html("");$("#中宮資訊-流年十神").html("");}};function 清除流年宮位(){for(var i=0;i<12;i++){$("#流年宮位-"+i).html("<br>");}$("#中宮資訊-流年").html("");$("#中宮資訊-流年十神").html("");};function 清除星曜顏色(){for(var i=0;i<12;i++){for(var j=1;j<7;j++){$("#星曜格-"+i+"-"+j).removeClass("化祿字體顏色 化權字體顏色 化科字體顏色 化忌字體顏色");$("#星曜格-"+i+"-"+j).removeClass("化祿背景顏色 化權背景顏色 化科背景顏色 化忌背景顏色");$("#星曜格-"+i+"-"+j).removeClass("化祿星曜顏色 化權星曜顏色 化科星曜顏色 化忌星曜顏色");}$("#宮干格-"+i).removeClass("宮干飛顏色");$("#ds-DZ-"+i).removeClass("飛四化人事宮");}};function 排星曜(命盤){var 大限起歲,大限起歲字;for(var i=0;i<12;i++){var 星曜矩陣=命盤.地支宮位[i].星曜;for(var j=0;j<星曜矩陣.length;j++){$("#星曜格-"+i+"-"+Number(j+1)).html(星曜矩陣[j]);命盤.星曜[星曜矩陣[j]].命盤位置=i+"-"+Number(j+1);$("#四化格-"+i+"-"+Number(j+1)).html(命盤.星曜[星曜矩陣[j]].生年四化);$("#自化格-"+i+"-"+Number(j+1)).html(命盤.星曜[星曜矩陣[j]].自化);}大限起歲字=命盤.地支宮位[i].大限歲數段.split(" ");大限起歲=Number(大限起歲字[0]);$("#宮名格-"+i).html(命盤.地支宮位[i].宮位);$("#宮干格-"+i).html(命盤.地支宮位[i].宮干);$("#地支格-"+i).html(命盤.地支宮位[i].地支);if(大限起歲<90)$("#大限歲數格-"+i).html(命盤.地支宮位[i].大限歲數段);}安流出四化(命盤.地支宮位);};function 安流出四化(地支矩陣){var 流出四化數;for(var i=0;i<12;i++){流出四化數=地支矩陣[i].宮干四化.流出矩陣.length;for(var j=0;j<流出四化數;j++){$("#流出格-"+i+"-"+Number(j+1)).html(地支矩陣[i].宮干四化.流出矩陣[j]);}}};function 刷新命盤大限(地支數,命盤){var 大限宮位;var j,流年二字,流年疊字,流年地支數;清除流年宮位歲數年份();for(var i=0;i<12;i++){j=地支滾動(1,i);大限宮位=大限人事宮字數轉換(j);$("#大限宮位-"+地支滾動(地支數,(-1)*i)).html(大限宮位);}if(命盤.運行.大限數<10){for(var k=0;k<10;k++){流年二字=(命盤.大限[命盤.運行.大限數].流年[k].西曆年).toString();流年疊字=流年二字.substr(0,2)+"<br>"+流年二字.substr(2,2);流年地支數=命盤.大限[命盤.運行.大限數].流年[k].地支數;$("#流年份格-"+流年地支數).html(流年二字);$("#流年歲數格-"+流年地支數).html(命盤.大限[命盤.運行.大限數].流年[k].歲數);$("#流年份格-"+流年地支數).attr("data-大運流年數",k.toString());$("#流年歲數格-"+流年地支數).attr("data-大運流年歲數",k.toString());}}};function 刷新命盤流年(地支數){var 流年宮位;var j;for(var i=0;i<12;i++){j=地支滾動(1,i);流年宮位=流年人事宮字數轉換(j);$("#流年宮位-"+地支滾動(地支數,(-1)*i)).html(流年宮位);}};function 刷新四化格式(){var 生年四化,生年四化顏色,自化,自化顏色,流出四化,流出顏色;for(var i=0;i<$(".ds-生年四化格式").length;i++){生年四化=$(".ds-生年四化格式").eq(i).html();自化=$(".ds-自化格式").eq(i).html();流出四化=$(".ds-流出格式").eq(i).html();$(".ds-生年四化格式").eq(i).removeClass("化祿字體顏色 化權字體顏色 化科字體顏色 化忌字體顏色");$(".ds-自化格式").eq(i).removeClass("化祿背景顏色 化權背景顏色 化科背景顏色 化忌背景顏色");$(".ds-流出格式").eq(i).removeClass("化祿背景顏色 化權背景顏色 化科背景顏色 化忌背景顏色");if(生年四化=="祿"||生年四化=="權"||生年四化=="科"||生年四化=="忌"){生年四化顏色=四化顏色選擇器(生年四化);$(".ds-生年四化格式").eq(i).addClass(生年四化顏色.字體);}if(自化=="祿"||自化=="權"||自化=="科"||自化=="忌"){自化顏色=四化顏色選擇器(自化);$(".ds-自化格式").eq(i).addClass(自化顏色.背景);}if(流出四化=="祿"||流出四化=="權"||流出四化=="科"||流出四化=="忌"){流出顏色=四化顏色選擇器(流出四化);$(".ds-流出格式").eq(i).addClass(流出顏色.背景);}}};function 刷新人事宮格式(){var 人事宮;for(var i=0;i<12;i++){人事宮=$(".ds-宮名字").eq(i).html();$(".ds-宮名字").eq(i).removeClass("命財官顏色 夫遷福顏色 田疾兄顏色 父子友顏色");if(人事宮=="命宮"||人事宮=="財帛宮"||人事宮=="官祿宮"){$(".ds-宮名字").eq(i).addClass("命財官顏色");}if(人事宮=="夫妻宮"||人事宮=="遷移宮"||人事宮=="福德宮"){$(".ds-宮名字").eq(i).addClass("夫遷福顏色");}if(人事宮=="田宅宮"||人事宮=="疾厄宮"||人事宮=="兄弟宮"){$(".ds-宮名字").eq(i).addClass("田疾兄顏色");}if(人事宮=="父母宮"||人事宮=="子女宮"||人事宮=="交友宮"){$(".ds-宮名字").eq(i).addClass("父子友顏色");}}};
function 四柱模塊(天干,地支){this.天干=天干; this.地支=地支;this.干支=天干+地支;this.納音=六十干支屬性(六十干支字轉值(this.干支),"納音");this.五行=六十干支屬性(六十干支字轉值(this.干支),"五行");this.運星="";};function 天干模塊(天干,日主天干){this.天干=天干;this.係數=天干屬性(天干,"係數");this.陰陽=天干屬性(天干,"陰陽");this.五行=天干屬性(天干,"五行");this.通根={"年":false,"月":false,"日":false,"時":false,"數":0};this.生祿={"年":false,"月":false,"日":false,"時":false,"數":0};this.陽刃={"年":false,"月":false,"日":false,"時":false,"數":0};this.帝旺={"年":false,"月":false,"日":false,"時":false,"數":0};if(日主天干!="")this.十神=尋十神(天干,日主天干);this.力量=0;};function 地支模塊(地支,日主天干){this.地支=地支;this.係數=地支屬性(地支,"係數");this.陰陽=地支屬性(地支,"陰陽");this.五行=地支屬性(地支,"五行");this.透干={"年":false,"月":false,"日":false,"時":false,"數":0};this.力量=0;this.庫馬花=地支屬性(地支,"庫馬花");this.藏干=地支屬性(地支,"藏干");this.藏干1=this.藏干.substr(0,1);if(this.藏干.length>1){this.藏干2=this.藏干.substr(1,1);}else{this.藏干2="";}if(this.藏干.length>2){this.藏干3=this.藏干.substr(2,1);}else{this.藏干3="";}this.藏干1力量=0;this.藏干2力量=0;this.藏干3力量=0;this.十神1=尋十神(this.藏干1,日主天干);this.十神2=尋十神(this.藏干2,日主天干);this.十神3=尋十神(this.藏干3,日主天干);this.十神1力量=0;this.十神2力量=0;this.十神3力量=0;};function 十神架構(命盤){var 日主=命盤.日干.天干;var 十神矩陣1=[命盤.年干.十神,命盤.月干.十神,"",命盤.時干.十神];var 十神矩陣2=[命盤.年支.十神1,命盤.月支.十神1,命盤.日支.十神1,命盤.時支.十神1];var 十神矩陣3=[命盤.年干.十神,命盤.月干.十神,"",命盤.時干.十神,命盤.年支.十神1,命盤.月支.十神1,命盤.日支.十神1,命盤.時支.十神1];var 年柱十神=[命盤.年干.十神,命盤.年支.十神1,命盤.年支.十神2,命盤.年支.十神3];var 月柱十神=[命盤.月干.十神,命盤.月支.十神1,命盤.月支.十神2,命盤.月支.十神3];var 日柱十神=["",命盤.日支.十神1,命盤.日支.十神2,命盤.日支.十神3];var 時柱十神=[命盤.時干.十神,命盤.時支.十神1,命盤.時支.十神2,命盤.時支.十神3];var 十神矩陣4=年柱十神.concat(月柱十神,日柱十神,時柱十神);var 十神總矩陣=[十神矩陣1,十神矩陣2,十神矩陣3,十神矩陣4];this.數據=[];for(var i=0;i<10;i++){this.數據[i]=new 十神模塊(i,十神總矩陣);}this.力量總和=0;this.內在=this.數據[十神字轉數("比肩")].天干地支+this.數據[十神字轉數("劫財")].天干地支+this.數據[十神字轉數("食神")].天干地支+this.數據[十神字轉數("傷官")].天干地支+this.數據[十神字轉數("正印")].天干地支+this.數據[十神字轉數("偏印")].天干地支;this.外界=this.數據[十神字轉數("偏財")].天干地支+this.數據[十神字轉數("正財")].天干地支+this.數據[十神字轉數("正官")].天干地支+this.數據[十神字轉數("七殺")].天干地支;this.偏=this.數據[十神字轉數("劫財")].命盤+this.數據[十神字轉數("傷官")].命盤+this.數據[十神字轉數("偏財")].命盤+this.數據[十神字轉數("七殺")].命盤+this.數據[十神字轉數("偏印")].命盤;this.正=this.數據[十神字轉數("比肩")].命盤+this.數據[十神字轉數("食神")].命盤+this.數據[十神字轉數("正財")].命盤+this.數據[十神字轉數("正官")].命盤+this.數據[十神字轉數("正印")].命盤;};function 十神模塊(十神數,十神總矩陣){this.十神=十神數轉字(十神數);this.力量=0;this.力量比率=0;for(var j=0;j<十神總矩陣.length;j++){var 十神數量=0;var 十神矩陣=十神總矩陣[j];for(var i=0;i<十神矩陣.length;++i){if(十神矩陣[i]==十神數轉字(十神數))十神數量++;}switch(j){case 0:this.天干=十神數量;break;case 1:this.地支本氣=十神數量;break;case 2:this.天干加地支本氣=十神數量;break;case 3:this.命盤=十神數量;break;}}};function 五行架構(命盤){var 五行矩陣=[命盤.年干.五行,命盤.年支.五行,命盤.月干.五行,命盤.月支.五行,命盤.日干.五行,命盤.日支.五行,命盤.時干.五行,命盤.時支.五行];var 陰陽矩陣=[命盤.年干.陰陽,命盤.年支.陰陽,命盤.月干.陰陽,命盤.月支.陰陽,命盤.日干.陰陽,命盤.日支.陰陽,命盤.時干.陰陽,命盤.時支.陰陽];this.陽=陰陽矩陣.filter(function(value){return value=="陽"}).length;this.陰=陰陽矩陣.filter(function(value){return value=="陰"}).length;this.全陽全陰="";this.木=new 五行模塊(命盤.日干.五行,"木",五行矩陣);this.火=new 五行模塊(命盤.日干.五行,"火",五行矩陣);this.土=new 五行模塊(命盤.日干.五行,"土",五行矩陣);this.金=new 五行模塊(命盤.日干.五行,"金",五行矩陣);this.水=new 五行模塊(命盤.日干.五行,"水",五行矩陣);this.五行力量總和=0;this.五行總和比率=0;this.數據=[];this.五行力量順序=[];this.五行喜忌={"木":"","火":"","土":"","金":"","水":"","五行喜":"","五行忌":""};this.五行喜忌總結=[];this.五行具足={"五行俱全":false,"缺木":false,"缺火":false,"缺土":false,"缺金":false,"缺水":false,"欠缺五行":""};};function 五行模塊(日主五行,五行元件,五行矩陣){this.五行=五行元件;this.五神=五行轉五神(日主五行,五行元件);this.數量=五行矩陣.filter(function(value){return value==五行元件}).length;this.力量=0;this.力量比率=0;this.力量形態="";this.力量形態數=0;this.力量順序= -1;this.喜忌="";this.流通=false;this.合化=0;};function 五神架構(命盤){this.比劫=new 五神模塊(命盤,"比劫");this.食傷=new 五神模塊(命盤,"食傷");this.財才=new 五神模塊(命盤,"財才");this.官殺=new 五神模塊(命盤,"官殺");this.印梟=new 五神模塊(命盤,"印梟");this.力量總和=0;};function 五神模塊(命盤,五神){this.五行=十神五行(命盤.日主,五神);this.力量=0;this.力量比率=0;};function 天干架構(命盤,選項){var 天干矩陣1=[命盤.年干.天干,命盤.月干.天干,命盤.日干.天干,命盤.時干.天干];var 天干矩陣2=[命盤.年支.藏干1,命盤.月支.藏干1,命盤.日支.藏干1,命盤.時支.藏干1];var 天干矩陣3=[命盤.年干.天干,命盤.月干.天干,命盤.日干.天干,命盤.時干.天干,命盤.年支.藏干1,命盤.月支.藏干1,命盤.日支.藏干1,命盤.時支.藏干1];var 年柱干=[命盤.年干.天干,命盤.年支.藏干1,命盤.年支.藏干2,命盤.年支.藏干3];var 月柱干=[命盤.月干.天干,命盤.月支.藏干1,命盤.月支.藏干2,命盤.月支.藏干3];var 日柱干=[命盤.日干.天干,命盤.日支.藏干1,命盤.日支.藏干2,命盤.日支.藏干3];var 時柱干=[命盤.時干.天干,命盤.時支.藏干1,命盤.時支.藏干2,命盤.時支.藏干3];var 天干矩陣4=年柱干.concat(月柱干,日柱干,時柱干);var 天干總矩陣=[天干矩陣1,天干矩陣2,天干矩陣3,天干矩陣4];this.天干數據=[];for(var i=0;i<10;i++){this.天干數據[i]=new 天干分析模塊(i,天干總矩陣);}};function 天干分析模塊(天干數,天干總矩陣){this.十干=天干數轉字(天干數);this.力度=0;this.合="";this.爭合="";for(var j=0;j<天干總矩陣.length;j++){var 天干數量=0;天干矩陣=天干總矩陣[j];for(var i=0;i<天干矩陣.length;++i){if(天干矩陣[i]==天干數轉字(天干數))天干數量++;}switch(j){case 0:this.天干=天干數量;break;case 1:this.地支本氣=天干數量;break;case 2:this.天干加地支本氣=天干數量;break;case 3:this.命盤=天干數量;break;}}};function 四柱架構(命盤){this.干合=0;this.半合=0;this.六合=0;this.暗合=0;this.相冲=0;this.相害=0;this.相刑=0;this.神煞=new 命盤神煞設定();this.神煞矩陣=[];this.四柱數據=[];this.天干力度=[];this.地支力度=[];for(var i=0;i<4;i++){this.四柱數據[i]=new 四柱分析模塊(i);}this.四柱數據[0].天干=命盤.年干.天干;this.四柱數據[0].地支=命盤.年支.地支;this.四柱數據[1].天干=命盤.月干.天干;this.四柱數據[1].地支=命盤.月支.地支;this.四柱數據[2].天干=命盤.日干.天干;this.四柱數據[2].地支=命盤.日支.地支;this.四柱數據[3].天干=命盤.時干.天干;this.四柱數據[3].地支=命盤.時支.地支;this.四柱數據[0].運星=命盤.年柱.運星;this.四柱數據[1].運星=命盤.月柱.運星;this.四柱數據[2].運星=命盤.日柱.運星;this.四柱數據[3].運星=命盤.時柱.運星;this.四柱數據[0].天干十神=命盤.年干.十神;this.四柱數據[0].地支十神1=命盤.年支.十神1;this.四柱數據[0].地支十神2=命盤.年支.十神2;this.四柱數據[0].地支十神3=命盤.年支.十神3;this.四柱數據[1].天干十神=命盤.月干.十神;this.四柱數據[1].地支十神1=命盤.月支.十神1;this.四柱數據[1].地支十神2=命盤.月支.十神2;this.四柱數據[1].地支十神3=命盤.月支.十神3;this.四柱數據[2].天干十神="";this.四柱數據[2].地支十神1=命盤.日支.十神1;this.四柱數據[2].地支十神2=命盤.日支.十神2;this.四柱數據[2].地支十神3=命盤.日支.十神3;this.四柱數據[3].天干十神=命盤.時干.十神;this.四柱數據[3].地支十神1=命盤.時支.十神1;this.四柱數據[3].地支十神2=命盤.時支.十神2;this.四柱數據[3].地支十神3=命盤.時支.十神3;this.四柱數據[0].天干五行=命盤.年干.五行;this.四柱數據[1].天干五行=命盤.月干.五行;this.四柱數據[2].天干五行=命盤.日干.五行;this.四柱數據[3].天干五行=命盤.時干.五行;this.四柱數據[0].地支五行=命盤.年支.五行;this.四柱數據[1].地支五行=命盤.月支.五行;this.四柱數據[2].地支五行=命盤.日支.五行;this.四柱數據[3].地支五行=命盤.時支.五行;};function 四柱分析模塊(四柱數){this.四柱=四柱名稱(四柱數);this.天干="";this.天干五行="";this.地支="";this.地支五行="";this.天干十神="";this.地支十神1="";this.地支十神2="";this.地支十神3="";this.神煞=new 四柱神煞設定();this.神煞矩陣=[];this.財庫=false;this.通根={"年":false,"月":false,"日":false,"時":false,"數":0};this.透干={"年":false,"月":false,"日":false,"時":false,"數":0};this.生祿={"年":false,"月":false,"日":false,"時":false,"數":0};this.陽刃={"年":false,"月":false,"日":false,"時":false,"數":0};this.帝旺={"年":false,"月":false,"日":false,"時":false,"數":0};this.天干五合="";this.五合鄰遙爭="";this.天干五合化="";this.五合天干="";this.五合數量=0;this.五合柱="";this.五合柱不參與="0123";this.五合柱間隔=0;this.五合補充="";this.干支合化="";this.干支合化補充="";this.三會="";this.三會化="";this.三會柱="";this.三會柱不參與="";this.三會補充="";this.總合=0;this.三合="";this.三合化="";this.三合柱="";this.三合柱不參與="";this.三合補充="";this.三刑="";this.三刑柱="";this.三刑柱不參與="";this.三刑補充="";this.半合="";this.半合地支="";this.半合鄰遙爭="";this.半合數量=0;this.半合柱="";this.半合柱不參與="0123";this.半合柱間隔=0;this.半合化="";this.半合補充="";this.六合="";this.六合化="";this.六合地支="";this.六合鄰遙爭="";this.六合數量=0;this.六合柱="";this.六合柱不參與="0123";this.六合柱間隔=0;this.六合補充="";this.暗合="";this.暗合化="";this.暗合地支="";this.暗合天干="";this.暗合鄰遙爭="";this.暗合數量=0;this.暗合柱="";this.暗合柱不參與="0123";this.暗合柱間隔=0;this.暗合補充="";this.三合爭合="";this.總刑=0;this.相刑="";this.相刑地支="";this.相刑鄰遙爭="";this.相刑數量=0;this.相刑柱="";this.相刑柱不參與="0123";this.相刑柱間隔=0;this.相刑方向= -1;this.相刑補充="";this.相冲="";this.相冲地支="";this.相冲鄰遙爭="";this.相冲數量=0;this.相冲柱="";this.相冲柱不參與="0123";this.相冲柱間隔=0;this.相冲庫馬花="";this.相冲補充="";this.相害="";this.相害地支="";this.相害鄰遙爭="";this.相害數量=0;this.相害柱="";this.相害柱不參與="0123";this.相害柱間隔=0;this.相害補充="";this.刑冲合會害=new 四柱刑冲合會害屬性();};function 四柱刑冲合會害屬性(){this.總結=[];this.相冲={"冲":false,"地支條件":"","數量":0,"四柱":"","四柱不參與":"","間隔":0,"備註":"","庫馬花":""};this.相害={"害":false,"地支條件":"","數量":0,"四柱":"","四柱不參與":"","間隔":0,"備註":""};};function 四柱神煞設定(){this.天乙貴人=false;this.天德=false;this.日德=false;this.月德=false;this.三奇貴人=false;this.文昌=false;this.太極貴人=false;this.福星=false;this.魁罡=false;this.紅鸞=false;this.天喜=false;this.學堂=false;this.十干祿=false;this.驛馬=false;this.將星=false;this.華蓋=false;this.金輿=false;this.天醫=false;this.空亡=false;this.劫煞=false;this.亡神=false;this.羊刃=false;this.元辰=false;this.災煞=false;this.桃花=false;this.紅艷=false;this.四廢日=false;this.孤辰=false;this.寡宿=false;this.天羅地網=false;this.十惡大敗=false;this.天地轉殺=false;};function 命盤神煞設定(){this.空亡=0;this.魁罡=0;this.羊刃=0;};function 地支架構(命盤){var 地支矩陣=[命盤.年支.地支,命盤.月支.地支,命盤.日支.地支,命盤.時支.地支];this.地支數據=[];for(var i=0;i<12;i++){this.地支數據[i]=new 地支分析模塊(i,地支矩陣);}this.三會=new 地支三會模塊();this.三合=new 地支三合模塊();this.半合=0;this.三刑=new 地支三刑模塊();this.相刑=0;this.六合=0;this.相冲=0;this.相害=0;};function 地支三合模塊(){this.命盤三合= -1;this.命盤三合支="";this.三合柱= -1;this.不參與地支="";this.不參與地支柱= -1;this.合出五行="";this.爭合地支="";this.爭合地支柱= -1;};function 地支三會模塊(){this.命盤三會= -1;this.命盤三會支="";this.三會柱= -1;this.不參與地支="";this.不參與地支柱= -1;this.會出五行="";};function 地支三刑模塊(){this.命盤三刑= -1;this.命盤三刑支="";this.三刑柱= -1;this.不參與地支="";this.不參與地支柱= -1;};function 地支分析模塊(地支數,地支矩陣){var 地支數量=0;for(var i=0;i<地支矩陣.length;++i){if(地支矩陣[i]==地支數轉字(地支數))地支數量++;}this.地支=地支數轉字(地支數);this.數量=地支數量;this.力度=0;this.合=0;this.爭合=0;};function 庫馬花架構(命盤){var 地支矩陣=[命盤.年支.地支,命盤.月支.地支,命盤.日支.地支,命盤.時支.地支];var 庫量=0,馬量=0,花量=0;for(i=0;i<地支矩陣.length;i++){if(地支矩陣[i]=="辰"||地支矩陣[i]=="戌"||地支矩陣[i]=="丑"||地支矩陣[i]=="未")庫量++;if(地支矩陣[i]=="子"||地支矩陣[i]=="午"||地支矩陣[i]=="卯"||地支矩陣[i]=="酉")花量++;if(地支矩陣[i]=="寅"||地支矩陣[i]=="申"||地支矩陣[i]=="巳"||地支矩陣[i]=="亥")馬量++;}this.庫=庫量;this.馬=馬量;this.花=花量;};function 大運模塊(陽男陰女,西曆生年,大運數,農曆生月干支,起歲,日主天干,時柱干支){this.流年=[];if(陽男陰女=="陽男"||陽男陰女=="陰女")大運順逆=1;if(陽男陰女=="陰男"||陽男陰女=="陽女")大運順逆= -1;if(大運數==0){this.起年=西曆生年;this.起歲=1;this.干支="--";var 大運干支數=六十干支字轉值(時柱干支);var 大運起年=西曆生年;var 大運起歲=1;this.歲數間距="1-"+(Number(起歲-1));}else if(大運數>0){var 大運起年=(大運數-1)*10+西曆生年+(起歲-1);var 大運起歲=(大運數-1)*10+起歲;var 大運干支數=六十干支字轉值(農曆生月干支);this.起年=大運起年;this.起歲=大運起歲;this.干支=六十干支屬性(干支滾動(大運干支數,大運順逆*大運數),1);this.歲數間距=大運起歲+"-"+(Number(大運起歲+9));}for(var i=0;i<=9;i++){var 對應流年=((大運數>0)||(大運數==0&&i<起歲-1))?true:false;this.流年[i]=new 流年模塊(大運數,大運起年+i,大運起歲+i,日主天干,對應流年,大運干支數,大運順逆,時柱干支,陽男陰女);}this.天干十神=尋十神(this.干支.substr(0,1),日主天干);this.藏干=地支屬性(this.干支.substr(1,1),"藏干");this.藏干1=this.藏干.substr(0,1);if(this.藏干.length>1){this.藏干2=this.藏干.substr(1,1);}else{this.藏干2="";}if(this.藏干.length>2){this.藏干3=this.藏干.substr(2,1);}else{this.藏干3="";}this.地支十神1=尋十神(this.藏干1,日主天干);this.地支十神2=尋十神(this.藏干2,日主天干);this.地支十神3=尋十神(this.藏干3,日主天干);this.運星=十二星運數轉字(十二星運(日主天干,this.干支.substr(1,1)));this.納音=六十干支屬性(六十干支字轉值(this.干支),"納音");if(大運數>0){this.大運顯示=this.干支;}else if(大運數==0){this.大運顯示="-";}};function 流年模塊(大運數,年份,歲數,日主天干,對應流年,大運干支數,大運順逆,時柱干支,陽男陰女){if(對應流年){this.年份=年份;this.歲數=歲數;this.小運=尋小運(時柱干支,歲數,陽男陰女);if(大運數==0){this.干支=六十干支屬性(干支滾動(1,年份-1924),1);this.藏干=地支屬性(this.干支.substr(1,1),"藏干");this.藏干1=this.藏干.substr(0,1);if(this.藏干.length>1){this.藏干2=this.藏干.substr(1,1);}else{this.藏干2="";}if(this.藏干.length>2){this.藏干3=this.藏干.substr(2,1);}else{this.藏干3="";}this.地支十神1=尋十神(this.藏干1,日主天干);this.地支十神2=尋十神(this.藏干2,日主天干);this.地支十神3=尋十神(this.藏干3,日主天干);this.運星=十二星運數轉字(十二星運(日主天干,this.干支.substr(1,1)));this.納音=六十干支屬性(六十干支字轉值(this.干支),"納音");}if(大運數>0)this.干支=六十干支屬性(干支滾動(1,年份-1924),1);this.天干十神=尋十神(this.干支.substr(0,1),日主天干);this.藏干=地支屬性(this.干支.substr(1,1),"藏干");this.藏干1=this.藏干.substr(0,1);if(this.藏干.length>1){this.藏干2=this.藏干.substr(1,1);}else{this.藏干2="";}if(this.藏干.length>2){this.藏干3=this.藏干.substr(2,1);}else{this.藏干3="";}this.地支十神1=尋十神(this.藏干1,日主天干);this.地支十神2=尋十神(this.藏干2,日主天干);this.地支十神3=尋十神(this.藏干3,日主天干);this.運星=十二星運數轉字(十二星運(日主天干,this.干支.substr(1,1)));this.納音=六十干支屬性(六十干支字轉值(this.干支),"納音");}else if(!對應流年){this.年份="";this.歲數="";this.干支="";this.天干十神="";this.地支藏干="";this.地支十神1="";this.地支十神2="";this.地支十神3="";this.運星="";this.納音="";this.小運="";}};function 流月模塊(年份,日主天干,月數){if(parseInt(年份)>1923){var 挪前數=(12*(年份-1924))+月數;this.干支=六十干支屬性(干支滾動(3,挪前數),1);this.天干十神=尋十神(this.干支.substr(0,1),日主天干);this.地支藏干=地支屬性(this.干支.substr(1,1),"藏干");this.地支十神1=尋十神(this.地支藏干.substr(0,1),日主天干);this.地支十神2=尋十神(this.地支藏干.substr(1,1),日主天干);this.地支十神3=尋十神(this.地支藏干.substr(2,1),日主天干);this.運星=十二星運數轉字(十二星運(日主天干,this.干支.substr(1,1)));}else{this.干支="";this.天干十神="";this.地支藏干="";this.地支十神1="";this.地支十神2="";this.地支十神3="";this.運星="";}};function 現行大運數(西曆生年,起歲){var 今年虛歲=排盤年份虛歲("虛歲",西曆生年);var TestAge=1,大運數;for(var i=0;TestAge<=今年虛歲;i++){TestAge=i*10+起歲;大運數=i;}大運數=(大運數<=8)?大運數:8;return 大運數;};function 現行大運流年數(大運起年){return 排盤年份虛歲("年份")-大運起年;};function 起小運(時柱,生年,陽男陰女){var 小運矩陣=[];var 小運順逆,小運資訊;if(陽男陰女=="陽男"||陽男陰女=="陰女")小運順逆=1;if(陽男陰女=="陰男"||陽男陰女=="陽女")小運順逆= -1;for(var i=0;i<90;i++){小運資訊={"干支":六十干支屬性(干支滾動(六十干支字轉值(時柱),小運順逆*(i+1)),"干支"),"年份":生年+i,"歲數":i+1};小運矩陣.push(小運資訊);}return 小運矩陣;};function 尋小運(時柱,歲數,陽男陰女){var 小運順逆,小運干支;if(陽男陰女=="陽男"||陽男陰女=="陰女")小運順逆=1;if(陽男陰女=="陰男"||陽男陰女=="陽女")小運順逆= -1;小運干支=六十干支屬性(干支滾動(六十干支字轉值(時柱),小運順逆*歲數),"干支");return 小運干支;};function 尋起運(生日,上個節氣,下個節氣,陽男陰女){var 起年,起月,天差數,時差數,起歲,起運順逆,起運節氣;if(生日.getSeconds==1)return "000000";var 生日時辰=生日.getHours()+":"+生日.getMinutes()+":"+生日.getSeconds();var 生日時辰數=時間轉換地支(生日時辰,"時數");var 生日日期=new Date(生日);生日日期.setHours(0);生日日期.setMinutes(0);生日日期.setSeconds(0);生日日期.setMilliseconds(0);if((陽男陰女=="陽男")||(陽男陰女=="陰女")){起運順逆=true;var 距離節氣小時=moment.duration(下個節氣-生日).asHours();起運節氣=new Date(下個節氣);var 節氣日期=new Date(下個節氣);節氣日期.setHours(0);節氣日期.setMinutes(0);節氣日期.setSeconds(0);節氣日期.setMilliseconds(0);天差數=parseInt(moment.duration(節氣日期-生日日期).asDays());var 節氣時辰=下個節氣.getHours()+":"+下個節氣.getMinutes()+":"+下個節氣.getSeconds();var 節氣時辰數=時間轉換地支(節氣時辰,"時數");if((節氣時辰數-生日時辰數)<0){時差數=節氣時辰數-生日時辰數+12;天差數-=1;}else 時差數=節氣時辰數-生日時辰數;}if((陽男陰女=="陰男")||(陽男陰女=="陽女")){起運順逆=false;var 距離節氣小時=moment.duration(生日-上個節氣).asHours();起運節氣=new Date(上個節氣);var 節氣日期=new Date(上個節氣);節氣日期.setHours(0);節氣日期.setMinutes(0);節氣日期.setSeconds(0);節氣日期.setMilliseconds(0);天差數=parseInt(moment.duration(生日日期-節氣日期).asDays());var 節氣時辰=上個節氣.getHours()+":"+上個節氣.getMinutes()+":"+上個節氣.getSeconds();var 節氣時辰數=時間轉換地支(節氣時辰,"時數");if((生日時辰數-節氣時辰數)<0){時差數=生日時辰數-節氣時辰數+12;天差數+=1;}else 時差數=生日時辰數-節氣時辰數;}var 起運月數=天差數*4+Math.floor((時差數*10)/30);var 起運天數=(時差數*10)-Math.floor((時差數*10)/30)*30;var 起運年數=Math.floor(起運月數/12);起運月數=起運月數-起運年數*12;起歲=zeroPad(起運年數,2)+zeroPad(起運月數,2)+zeroPad(起運天數,2);var 起運年句,起運月句,起運天句;if(起運年數!=0)起運年句=起運年數+"年";else 起運年句="";if(起運月數!=0)起運月句=起運月數+"月";else 起運月句="";if(起運天數!=0)起運天句=起運天數+"天";else 起運天句="";var 上運日期=new Date(生日);上運日期.setFullYear(上運日期.getFullYear()+起運年數);上運日期.setMonth(上運日期.getMonth()+起運月數);上運日期.setDate(上運日期.getDate()+起運天數);var 生年干支=六十干支屬性((上運日期.getFullYear()-1923)%60,"干支");var 下個換運天干=天干數轉字(天干滾動(天干字轉值(生年干支.substr(0,1)),5));var 起歲元件={"陽男陰女":陽男陰女,"起運順逆":起運順逆?"順行":"逆行","小時距離":距離節氣小時,"天數距離":天差數,"時辰距離":時差數,"起運年數":起運年數,"起運月數":起運月數,"起運天數":起運天數,"起運數字串":起歲,"節氣日期":起運節氣,"起運距離句子":"生日與節氣日子相差"+天差數+"天"+時差數+"個時辰","起運":"出生"+起運年句+起運月句+起運天句+"後起運","上運":"陽曆"+上運日期.getFullYear()+"年（"+生年干支+"）"+(上運日期.getMonth()+1)+"月"+上運日期.getDate()+"日後上運","交脫":"每逢"+生年干支.substr(0,1)+"、"+下個換運天干+"年"+ +(上運日期.getMonth()+1)+"月"+上運日期.getDate()+"日交脫","備註":""};return 起歲元件;};function 排盤年份虛歲(選項,生年){if(生年==undefined)生年=2000;var 現在=new Date();var 昨天=現在.setDate(現在.getDate()-1);var 今年年份=new Date().getFullYear();var 今年虛歲=今年年份-生年+1;var 今年立春=萬年曆("立春",今年年份);if(現在<今年立春){今年年份=今年年份-1;今年虛歲=今年虛歲-1;}switch(選項){case "年份":return 今年年份;case "虛歲":return 今年虛歲;}};function 八字命盤架構(輸入資料,系統設定){var 輸入生日=new 日期格式(輸入資料.西曆日期);var 干支曆=西曆轉換干支曆(輸入資料);var 農曆=西曆轉換農曆(輸入資料.西曆日期,輸入資料.城市,輸入資料.夜子時,false,false,false,false);var 陰曆=農曆轉換陰曆(農曆);var 曆法={"干支曆":干支曆,"農曆":農曆,"陰曆":陰曆,"資訊":new function(){this.人元司令="";this.交節日="";this.調整軌道的時差=軌道太陽時調整(輸入資料.運算西曆,"時差");this.城市時差="";this.日光節約=日光節約(Number(輸入資料.年),輸入資料.國家);this.備註="-";},"備註":""};if(曆法.干支曆.交節){var 交節日期=new 日期格式(曆法.干支曆.交節日期);if(曆法.干支曆.交節日節令==曆法.干支曆.節令)曆法.資訊.交節日="當天為交節日，剛進入"+曆法.干支曆.交節日節令+"。交節時間為"+交節日期.西曆;if(曆法.干支曆.交節日節令!=曆法.干支曆.節令)曆法.資訊.交節日="當天為交節日，即將進入"+曆法.干支曆.交節日節令+"。交節時間為"+交節日期.西曆;}var 節氣天數字串=(曆法.干支曆.當下節令距離天數==0)?曆法.干支曆.節令+"當天，":曆法.干支曆.節令+"後"+曆法.干支曆.當下節令距離天數+"天，";曆法.資訊.人元司令="生於"+曆法.干支曆.月令+"月，"+節氣天數字串+曆法.干支曆.司令+天干屬性(曆法.干支曆.司令,"五行")+"當令";if(輸入資料.城市!="台北")曆法.資訊.城市時差=城市時間調整(輸入資料.城市,輸入生日,false,"時差");this.輸入資料=輸入資料;this.曆法=曆法;this.陽男陰女="";this.起歲=0;this.起運="";this.生日={"西曆生日":輸入資料.西曆日期,"運算生日":曆法.干支曆.運算的西曆,"西曆生日格式":new 日期格式(輸入資料.西曆日期),"西曆年":輸入生日.Year,"西曆月":輸入生日.Month,"西曆日":輸入生日.Day,"西曆時":輸入生日.Hour,"西曆分":輸入生日.Minute,"西曆中文":(輸入資料.西曆日期.getSeconds()==1)?輸入生日.西曆日期:輸入生日.西曆,"西曆英文":輸入生日.MalaysiaDate,"性別":輸入資料.性別,"星座":尋星座(輸入生日.Month,輸入生日.Day,1),"星座代號":尋星座(輸入生日.Month,輸入生日.Day,3),"八字":曆法.干支曆.四柱,"節氣":曆法.干支曆.節氣,"節氣數":曆法.干支曆.節氣數,"節令":曆法.干支曆.節令,"節令日期":曆法.干支曆.節令日期,"下個節令日期":曆法.干支曆.下個節令日期,"中氣":曆法.干支曆.中氣節,"中氣日期":曆法.干支曆.中氣日期,"交節日":曆法.干支曆.交節,"當下節令距離天數":曆法.干支曆.當下節令距離天數,"四季":曆法.干支曆.四季,"旺相休囚死":"","農曆":曆法.農曆.日期,"農曆年":曆法.農曆.干支年,"農曆月":曆法.農曆.月,"農曆日":曆法.農曆.日,"農曆時":曆法.農曆.時,"農曆年干支":曆法.農曆.干支年,"干支生月數":曆法.干支曆.生月數,"命宮生月數":判斷命宮生月數(曆法,系統設定.設定.運算設定.命宮月數),"生肖":曆法.干支曆.生肖,"起運":"","虛歲":排盤年份虛歲("虛歲",輸入資料.西曆日期.getFullYear()),};系統.設定.用戶設定.輸入預設.象論排十神=輸入資料.象論盤;this.日主=this.生日.八字.substr(4,1);this.月令=this.生日.八字.substr(3,1);this.日主五行=天干屬性(this.日主,"五行");this.年干=new 天干模塊(this.生日.八字.substr(0,1),this.日主);this.年支=new 地支模塊(this.生日.八字.substr(1,1),this.日主);this.月干=new 天干模塊(this.生日.八字.substr(2,1),this.日主);this.月支=new 地支模塊(this.生日.八字.substr(3,1),this.日主);this.日干=new 天干模塊(this.生日.八字.substr(4,1),"");this.日支=new 地支模塊(this.生日.八字.substr(5,1),this.日主);this.時干=new 天干模塊(this.生日.八字.substr(6,1),this.日主);this.時支=new 地支模塊(this.生日.八字.substr(7,1),this.日主);this.年柱=new 四柱模塊(this.年干.天干,this.年支.地支);this.月柱=new 四柱模塊(this.月干.天干,this.月支.地支);this.日柱=new 四柱模塊(this.日干.天干,this.日支.地支);this.時柱=new 四柱模塊(this.時干.天干,this.時支.地支);this.年柱.運星=十二星運數轉字(十二星運(this.日干.天干,this.年支.地支));this.月柱.運星=十二星運數轉字(十二星運(this.日干.天干,this.月支.地支));this.日柱.運星=十二星運數轉字(十二星運(this.日干.天干,this.日支.地支));this.時柱.運星=十二星運數轉字(十二星運(this.日干.天干,this.時支.地支));this.陽男陰女=尋陽男陰女(this.輸入資料.性別,this.年支.地支);this.旺相休囚死=日干月令對照(this.日干.天干,this.月支.地支,"旺相休囚死");this.人元司令=曆法.干支曆.司令;this.命宮=尋命宮(this.年干.天干,this.生日.命宮生月數,this.時支.地支,this.生日.節氣數,"氣");this.身宮=尋身宮(this.年干.天干,this.生日.命宮生月數,this.時支.地支);this.胎元=尋胎元(this.月柱.干支);this.胎息=尋胎息(this.日柱.干支);this.空亡={"年柱":判空亡(this.年柱.干支),"日柱":判空亡(this.日柱.干支)};this.起運=尋起運(this.生日.運算生日,曆法.干支曆.節令日期,曆法.干支曆.下個節令日期,this.陽男陰女);console.log(this.起運);var BornMonth=this.生日.運算生日.getMonth();var StartYear=this.起運.起運年數;if(BornMonth+this.起運.起運月數>12)StartYear+=1;this.起歲=StartYear+1;this.大運=[];for(var i=0;i<=9;i++){this.大運[i]=new 大運模塊(this.陽男陰女,this.生日.運算生日.getFullYear(),i,this.月柱.干支,this.起歲,this.日干.天干,this.時柱.干支);}this.運行={"大運數":現行大運數(this.生日.西曆年,this.起歲),"大運干支":"","歲數":"","大運流年數":"","流年年份":new Date().getFullYear(),"流年干支":"","流月用":0,"流月數":"","流月份":"","流月干支":""};this.運行.大運流年數=排盤年份虛歲("年份")-this.大運[this.運行.大運數].起年;this.流月=[];for(var i=0;i<=11;i++){this.流月[i]=new 流月模塊(this.運行.流年年份,this.日干.天干,i);}var 神煞數據=尋神煞(this.年柱.干支,this.月柱.干支,this.日柱.干支,this.時柱.干支,this.陽男陰女);this.神煞={"其他":神煞數據[0],"年柱":神煞數據[1],"月柱":神煞數據[2],"日柱":神煞數據[3],"時柱":神煞數據[4],"命盤":神煞數據[1].concat(神煞數據[2],神煞數據[3],神煞數據[4],神煞數據[0])};var 刑冲合會害矩陣=[];var 刑冲合會害表=[];var 用神喜忌矩陣=[];var 命盤基本數據矩陣=[];this.分析={"陰陽五行":new 五行架構(this),"五神":new 五神架構(this),"四柱":new 四柱架構(this),"天干":new 天干架構(this,0),"天干藏干":new 天干架構(this,1),"地支":new 地支架構(this),"強弱":{"日主":{"強弱":"","強弱值":"","數據":0},"印比":{"強弱":"","強弱值":"","數據":0},"殺剋洩":{"強弱":"","強弱值":"","數據":0},"身":{"強弱":"","強弱值":"","強弱數":0,"特別情況":0},"環境":{"令":"","環境值":0},"註解":[]},"十神":new 十神架構(this),"庫馬花":new 庫馬花架構(this),"刑冲合會害":{"三合":{"成立":false,"地支":"","合化":"","合化天干":"","合化註解":"","三合柱":"","不參與柱": -1,"不參與地支":"","爭合地支":"","爭合柱": -1,"備註":""},"三會":{"成立":false,"地支":"","五行":"","會化天干":"","三會柱":"","不參與柱": -1,"不參與地支":"","備註":""},"三刑":{"成立":false,"格局":"","地支":"","三刑柱":"","不參與柱": -1,"不參與地支":"","備註":""},"無禮":{"成立":false,"成局":false,"地支":"子卯","三刑柱":"","不參與柱":"","備註":""},"自刑":{"成立":false,"成局":false,"自刑數":0,"辰辰":{"成立":false,"地支":"辰辰","三刑柱":"","不參與柱":"","備註":""},"午午":{"成立":false,"成局":false,"地支":"午午","三刑柱":"","不參與柱":"","備註":""},"酉酉":{"成立":false,"成局":false,"地支":"酉酉","三刑柱":"","不參與柱":"","備註":""},"亥亥":{"成立":false,"成局":false,"地支":"亥亥","三刑柱":"","不參與柱":"","備註":""},"備註":""},"半合":"","六合":"","半刑":"","六沖":"","六害":"","合數":0,"刑數":0,"沖數":0,"害數":0,"備註":""},"個性":[],"疾病":[],"婚姻":[],"六親":[],"行運註解":new 行運分析設定()};this.命盤提示={"財庫":判斷財庫(this),"庫馬花":"","宮位":"命宮："+this.命宮+"，身宮："+this.身宮+"，胎元："+this.胎元+"，胎息："+this.胎息,"空亡":"日空亡："+this.空亡.日柱+"；年空亡："+this.空亡.年柱};$("#btn-十神格個性").show();if(系統.設定.用戶設定.App.八字流年表){填寫流年表(this.大運);$("#btn-八字流年表").show();}};function 判斷命宮生月數(輸入生日資料,選項){var 生日的中氣調整=new Date(輸入生日資料.干支曆.中氣日期);var 農曆生月=輸入生日資料.農曆.月;var 干支曆生月=輸入生日資料.干支曆.生月數;var 調整後的生月;var 運算的西曆=new Date(輸入生日資料.干支曆.運算的西曆);if(選項===undefined)選項=0;switch(選項){case 0:case "斗數":return 農曆生月;case 1:case "八字":switch(干支曆生月){case 1:調整後的生月=(運算的西曆>=生日的中氣調整)?2:1;break;case 2:調整後的生月=(運算的西曆>=生日的中氣調整)?3:2;break;case 3:調整後的生月=(運算的西曆>=生日的中氣調整)?4:3;break;case 4:調整後的生月=(運算的西曆>=生日的中氣調整)?5:4;break;case 5:調整後的生月=(運算的西曆>=生日的中氣調整)?6:5;break;case 6:調整後的生月=(運算的西曆>=生日的中氣調整)?7:6;break;case 7:調整後的生月=(運算的西曆>=生日的中氣調整)?8:7;break;case 8:調整後的生月=(運算的西曆>=生日的中氣調整)?9:8;break;case 9:調整後的生月=(運算的西曆>=生日的中氣調整)?10:9;break;case 10:調整後的生月=(運算的西曆>=生日的中氣調整)?11:10;break;case 11:調整後的生月=(運算的西曆>=生日的中氣調整)?12:11;break;case 12:調整後的生月=(運算的西曆>=生日的中氣調整)?1:12;break;default:alert("干支曆法生月："+干支曆生月+"。中氣日期："+生日的中氣調整);}break;default:　　;　　;　　;　　;　　;　　;　　;　　;　　;　　;　　;　　;　　;switch(干支曆生月){case 1:生日的中氣調整.setDate(生日的中氣調整.getDate()+5);調整後的生月=(運算的西曆>=生日的中氣調整)?2:1;break;case 2:生日的中氣調整.setDate(生日的中氣調整.getDate()+7);調整後的生月=(運算的西曆>=生日的中氣調整)?3:2;break;case 3:生日的中氣調整.setDate(生日的中氣調整.getDate()+9);調整後的生月=(運算的西曆>=生日的中氣調整)?4:3;break;case 4:生日的中氣調整.setDate(生日的中氣調整.getDate()+10);調整後的生月=(運算的西曆>=生日的中氣調整)?5:4;break;case 5:生日的中氣調整.setDate(生日的中氣調整.getDate()+9);調整後的生月=(運算的西曆>=生日的中氣調整)?6:5;break;case 6:生日的中氣調整.setDate(生日的中氣調整.getDate()+8);調整後的生月=(運算的西曆>=生日的中氣調整)?7:6;break;case 7:生日的中氣調整.setDate(生日的中氣調整.getDate()+9);調整後的生月=(運算的西曆>=生日的中氣調整)?8:7;break;case 8:生日的中氣調整.setDate(生日的中氣調整.getDate()+11);調整後的生月=(運算的西曆>=生日的中氣調整)?9:8;break;case 9:生日的中氣調整.setDate(生日的中氣調整.getDate()+13);調整後的生月=(運算的西曆>=生日的中氣調整)?10:9;break;case 10:生日的中氣調整.setDate(生日的中氣調整.getDate()+12);調整後的生月=(運算的西曆>=生日的中氣調整)?11:10;break;case 11:生日的中氣調整.setDate(生日的中氣調整.getDate()+8);調整後的生月=(運算的西曆>=生日的中氣調整)?12:11;break;case 12:生日的中氣調整.setDate(生日的中氣調整.getDate()+5);調整後的生月=(運算的西曆>=生日的中氣調整)?1:12;break;}}return 調整後的生月;};function 尋命宮(年干,生月數,時支,節氣數,計算模式){if(計算模式==undefined)計算模式="節";var 時支數=地支字轉值(時支);var 逆數月數,命宮地支數,時轉數;var 命宮起支;if(時支=="-"||時支=="")return "";switch(計算模式){case "節":逆數月數=(-1)*(生月數-1);命宮地支數=地支滾動(1,逆數月數);時轉數=((4-時支數)>=0)?4-時支數:4-時支數+12;命宮地支數=地支滾動(命宮地支數,時轉數);break;case "氣":case "中氣":switch(節氣數){case 23:case 0:命宮起支=5;break;case 1:case 2:命宮起支=4;break;case 3:case 4:命宮起支=3;break;case 5:case 6:命宮起支=2;break;case 7:case 8:命宮起支=1;break;case 9:case 10:命宮起支=0;break;case 11:case 12:命宮起支=11;break;case 13:case 14:命宮起支=10;break;case 15:case 16:命宮起支=9;break;case 17:case 18:命宮起支=8;break;case 19:case 20:命宮起支=7;break;case 21:case 22:命宮起支=6;break;default:alert("生月數："+生月數+"，"+"時："+時支+"節氣數："+節氣數+"，命宮地支："+命宮起支);}命宮地支數=地支滾動(命宮起支,(-1)*時支數);break;}var 命宮地支=地支數轉字(命宮地支數);var 命宮=月柱判斷(年干,命宮地支);return 命宮;};function 尋身宮(年干,農曆月數,時支){var 身宮地支數=地支滾動(3,農曆月數-1);var 時支數=地支字轉值(時支);var 生月子時起數=地支滾動(4,農曆月數-1);身宮地支數=地支滾動(生月子時起數,時支數-1);var 身宮地支=地支數轉字(身宮地支數);var 身宮=月柱判斷(年干,身宮地支);return 身宮;};function 尋胎元(農曆生月干支){var 月柱天干數=天干字轉值(農曆生月干支.substr(0,1));var 月柱地支數=地支字轉值(農曆生月干支.substr(1,1));var 胎元=天干數轉字(天干滾動(月柱天干數,1))+地支數轉字(地支滾動(月柱地支數,3));return 胎元;};function 尋胎息(日柱){return 天干生剋合(日柱.substr(0,1),"合")+地支六合冲害破(日柱.substr(1,1),"六合");};function 計算參數數據(){this.天干五合化=6;this.地支三會=12;this.地支三合=9;this.地支三刑=3;this.地支半合=6;this.地支六合=4;this.地支暗合=2;this.地支相刑=2;this.地支相害=2;this.合而不化= -1;this.干支基數=15;this.ChartNull=true;};function debug(){this.inputdate="";this.calcdate="";this.momentdate="";this.timezone="";this.now=new Date();} ;
function 系統初始(){this.版本=new 版本參數設定();this.設定=new 系統參數();};function 斗數命盤初始(){document.title=系統.版本.網頁標題;$("#div-斗數-生日輸入").html(Gen_生日輸入表格("查詢","斗數"));初始化生日輸入(true,true,false,false,false,false);$("#mp-輸入分").hide();$("#mp-輸入分字").hide();$("#Menu-四化飛伏").hide();if(系統.設定.用戶設定.輸入預設.命盤預設用當下時間==false){$("#mp-輸入年").val(系統.設定.用戶設定.輸入預設.年);$("#mp-輸入月").val(zeroPad(系統.設定.用戶設定.輸入預設.月,2));$("#mp-輸入日").val(zeroPad(系統.設定.用戶設定.輸入預設.日,2));$("#mp-輸入時").val(zeroPad(系統.設定.用戶設定.輸入預設.時,2));$("#mp-輸入分").val(zeroPad(0,2));}$("#DouShuChart").html(斗數十二宮格());$("#DouShuChart").hide();var systeminfo=$.pgwBrowser();系統.設定.system.瀏覽器=systeminfo.browser.name;系統.設定.system.瀏覽器版本=systeminfo.browser.fullVersion;系統.設定.system.平台系統=systeminfo.os.name;系統.設定.system.平台系統版本=systeminfo.os.fullVersion;系統.設定.system.ViewporWidth=systeminfo.viewport.width;系統.設定.system.ViewporHeight=systeminfo.viewport.height;系統.設定.system.ViewportOrientation=systeminfo.viewport.orientation;系統.設定.system.UserAgent=systeminfo.userAgent;$.getJSON('http://ipinfo.io',function(data){系統.設定.system.IP=data.ip;系統.設定.system.city=data.city;系統.設定.system.LatLong=data.loc;系統.設定.system.country=data.country;});} ;

